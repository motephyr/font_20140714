<% content_for :stylesheets do %>
<style type="text/css">

body,.container{
  background-color: #000000;
  width: 100%;
  height:100%;
}

h4 {
  color: #ffffff
}

.border_radius{
  border: 2px solid #D6D6D6;
  -webkit-border-radius: 100px;
  -moz-border-radius: 100px;
  border-radius: 100px;
}


.every_writer_box_down{
  float:left;
  //padding-top:15%;
  width:20%;
}



.correct{
  display:none;
  z-index:10;
  position:absolute;
  left:120px;
  top:120px;
}

</style>
<% end %>
<div style="margin:0 7%; height:100%;">
  <% @visitors.each do |x| %>
  <div class="visitor every_writer_box_down" style="padding:12% 0.5%;height:80%;">
    <div style="width:80%;margin:2% auto;">
      <%= render_gamer_photo(x,"thumb",40,40,"user_picture_no_block") %>
      <h4 style="display:inline;"><%= x.name %></h4>
      <span id="no_correct_<%= x.number %>" class="badge">0題</span>
      <%#= render_gamer_photo(x,"thumb",50,50) %>
    </div>
    <div style="position:relative;">
      <canvas id="origin_<%= x.number %>" class="orgincanvas canvas_box" ></canvas>
      <img id="yes_img_<%= x.number %>" src="/assets/O-mark.png" height="95" class="correct" ></img>
    </div>
    <div style="margin:1.5% 8%;min-height:18px;height:2.5%;">
      <canvas id="sketchSecond_<%= x.number %>" data-processing-sources="/assets/timebar.pde"></canvas>
    </div>
  </div>
  <% end %>
</div>

<% content_for :javascripts do %>
<%= javascript_include_tag 'server2-tvwall' %>
<%= javascript_include_tag 'server' %>

<script>

var sketchSecondIns = {};

//使用者送出確認
var receiveSubmitHandler = function(o){
  $('#origin_'+o.user_id).addClass("canvas_box_block");
};

//後台取消確認(尚未實作)
var receiveCancelSubmitHandler = function(o){
  $('#origin_'+o.user_id).removeClass("canvas_box_block");
};

//後台送出答對
function showO(c){
  $("#yes_img_" + c).show();
}

function removeO(c){
  $("#yes_img_" + c).hide();
}

function startSetStyle(c) {
  $('#user_photo_'+c).addClass("user_picture_block");
  sketchSecondIns[c].doStart();
}

function stopSetStyle(c) {
  $('#user_photo_'+c).removeClass("user_picture_block");
  sketchSecondIns[c].doStop();
}

//Gamer out
function outSetStyle(val) {
  $('#origin_'+val).hide();
  sketchSecondIns[val].clearBar();
}

function resetSetStyle(s) {
  $('#second_' + key).text(s + "秒");
  sketchSecondIns[key].resetBar();
  sketchSecondIns[key].setSecond(parseInt(s));
}

function correctCountSetStyle(o){
  $("#no_correct_" + o.user_id).text(o.count+"題");
}

$(document).ready(function() {

  var seconds = <%= @second %>;
  window.alarm = null;
  var no_correct = null;

  CM.prop({
    width: 500,
    height: 500,
    lineWidth: 15,
    lineColor: '#ffffff',
    targetZoomScale: 0.2,
    responsiveByParent: true,
    backgroundImage: '/assets/block.png'
  });
  <% @visitors.each do |visitor| %>
  CM.reg('origin_<%= visitor.number %>');
  <% end %>

  window.chatApp = new ChatApp(500,500,'0');
  window.chatApp.bindEvents();

  (function collectGamers() {
   <% @visitors.each do |visitor| %>
   gamers.push('<%= visitor.number %>');
   <% end %>
 })();

  setTimeout(function(){
    gamers.all().forEach(function(e){
      if(!sketchSecondIns[e]){
        sketchSecondIns[e] = Processing.getInstanceById('sketchSecond_'+e);  
      }
      var p = $(document.getElementById('sketchSecond_'+e).parentElement);
      sketchSecondIns[e].setSize(p.width(), p.height());
      sketchSecondIns[e].setSecond(<%= @second %>);
      //stopSetStyle(e);
    });
  },300);

});
</script>
<% end %>