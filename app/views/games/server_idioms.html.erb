      <div class="jumbotron">
        <% if !@second.nil?  %>
        <h5>倒數計時 <span id="second" style="color:red"><%= @second %></span> 秒 </h5>
        <% else %>
        <h5>不倒數計時</h5>
        <% end %>
      </div>
      <div class="row" style="background-image: url('/assets/idioms_totalBlocks_2960x2000.png');background-size: 1200px 800px;padding-top:30px;padding-left:15px" >
        <% (1..96).to_a.each do |x| %>

        <div class="col-md-1" style="font-size:0px;line-height:0;width: 8.25%;">
          <canvas id="origin_<%= x %>" style="z-index:1;"></canvas>
        </div>

        <% end %>
      </div>
      <div class="row">
        <% @visitors.each do |x| %>
        <div class="visitor col-md-3" id="visitor_<%= x.number %>">
          <div class="row">
            <div class="col-md-1">
              <input type="checkbox" name="gamer" value="<%= x.number %>"/>
            </div>
            <div class="col-md-3">
              <%= render_gamer_photo(x.image,"thumb",50,50) %>
              <p><%= x.name %></p>
            </div>

          </div>
        </div>
        <% end %>
      </div>
      <div class="row">
        <div class="col-md-12">
          <input type="checkbox" id="allGamer"/>全選
          <button id="yes_button" style="font-size:15px;">答對</button>
          <button id="no_button" style="font-size:15px;">答錯</button>
          <button id="out_button" style="font-size:15px;">淘汰</button>
          <button id="start_button" style="font-size:15px;">Start</button>
          <button id="stop_button" style="font-size:15px;">Stop</button>
        </div>
      </div>

      <% content_for :javascripts do %>
      <%= javascript_include_tag 'server_idioms' %>
      <script>

      window.timeRemaining = parseInt(<%= @second %>);
      window.alarm = null;

      var afterAction = function(property){
        var array = [];
        $('[name="gamer"]').each(function(){
          if (this.checked) {
            $('#origin_'+this.value).css("border", "");
            array.push(this.value);
            this.checked = false;
          }
        });
        $('#second').text(window.timeRemaining);
        $('#allGamer').attr('checked',false);

        return array;
      }

      var receiveMoveBlockHandler = function(o){
        var ballColourArray = ["white","blue","green","yellow","black"];
        $('#origin_'+o.block).css("border", "2px solid "+ ballColourArray[o.user_id%ballColourArray.length] );
      };

      var receiveEndRoundHandler = function(o){
        clearInterval(window.alarm);
        window.alarm = null;
        window.chatApp.action(o.user_id,'stop');
        afterAction(this);
      };

      $(document).ready(function() {
        CM.prop({
          width: 500,
          height: 500,
          lineWidth: 15,
          lineColor: '#333333',
          targetZoomScale: 0.035
        });
        <% (1..96).each do |x| %>
        CM.reg('origin_<%= x %>');
        <% end %>

        window.chatApp = new ChatApp(500,500,'0');
        window.chatApp.bindEvents();



        $('#allGamer').click(function(){
          $('[name="gamer"]').each((function(toCheck){
            return function(){
              if (this.disabled == false){
                this.checked = toCheck;
              }
            };
          })(this.checked === true));
        });

        $('#yes_button').click(function(){
          var array = afterAction(this);
          for (var x in array){
            var yesImg = $('#yes_' + array[x]);
            yesImg.show();

            setTimeout(( function(item){
              var f = function(){
                item.hide();
              };
              return f
            })(yesImg), 3000);
          }
          //alert("answer right:"+array);
        });

        $('#no_button').click(function(){
          var array = afterAction(this);
          for (var x in array){
            var noImg = $('#no_' + array[x]);
            noImg.show();

            setTimeout((function(item){
              var f = function(){
                item.hide();
              };
              return f
            })(noImg), 3000);
          }
          //alert("answer wrong:"+array);
        });

        $('#out_button').click(function(){
          $('[name="gamer"]').each(function(){
            if (this.checked) {
              CM.unreg('origin_'+this.value);
              this.disabled = true;
            }
          });
          var array = afterAction(this);
          for (var x in array){
            $('#visitor_'+array[x]).attr('style','opacity:0.2');
          }
          //alert("outer:"+array);
        });

        $('#start_button').click(function(){
          if(window.alarm) return;
          $('[name="gamer"]').each(function(){
            if (this.checked) {
              window.chatApp.action(this.value,'start');
              $('#visitor_'+this.value).css("background-color", "");
            }
          });
          window.alarm = setInterval(function(){
            if (parseInt($('#second').text()) != 0){
              $('#second').text(parseInt($('#second').text()) - 1);
            }else{
              clearInterval(window.alarm);
              window.alarm = null;
              $('[name="gamer"]').each(function(){
                if (this.checked) {
                  window.chatApp.action(this.value,'stop');
                }
              });
              var array = afterAction(this);
              alert("stop:"+array);
            }
          },1000);
          //var array = afterAction(this);
          //alert("start:"+array);
        });

        // $('#stop_button').click(function(){
        //   $('[name="gamer"]').each(function(){
        //     if (this.checked) {
        //       window.chatApp.action(this.value,'stop');
        //     }
        //   });
        //   var array = afterAction(this);
        //   alert("stop:"+array);
        // });

    });
      </script>
      <% end %>